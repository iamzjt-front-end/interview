# 01_什么是强缓存和协商缓存

### 1. 浏览器缓存

`浏览器缓存` 是浏览器在本地磁盘对用户最近请求过的文档进行存储。

当访问者再次访问同一页面时，浏览器就可以直接从本地磁盘加载文档。

浏览器缓存主要分为`强缓存`（也称本地缓存）和`协商缓存`（也称弱缓存）。

### 2. 强缓存

当请求资源时，如果是之前请求过的并使用强缓存，那么在过期期间将不会发送本次请求向服务器获取资源，而是直接从浏览器缓存中获取（不管资源是否改动）。

过期了将重新从服务器获取，并再次强缓存。

强缓存是利用`http头`中的`Expires`和`Cache-Control`两个字段来控制的。

`Expires`是`http1.0`的规范，`Cache-Control`是在`http1.1`中出现的，我们这里使用`Cache-Control`示范。

`Cache-Control`有一些常设置的值：

- `private`: 仅浏览器可以缓存（默认值）
- `public`: 浏览器和代理服务器都可缓存
- `max-age=xxx`: 缓存的内容将在 xxx 秒后失效 
- `no-cache`: 不进行强缓存
- `no-store`: 不强缓存，也不协商缓存

### 3. 协商缓存

当请求资源时，如果是之前请求过的并使用协商缓存，还是发送请求到服务器。

服务器通过逻辑判断确认资源`没有修改`返回304状态码，那么本次本次的资源则是从缓存中获取；

如果经过判断确认资源`被修改过`，则重新发送资源到客户端，并且客户端更新缓存。

主要涉及到两组`header`字段：`Etag`和`If-None-Match`、`Last-Modified`和`if-modified-since`。

#### 3.1 ETag 和 If-None-Match

`ETag/If-None-Match`返回是一个校验码。

`ETag`可以保证每一个资源是唯一的，资源变化都会导致`ETag`变化。

服务器根据浏览器上送的`If-None-Match`值来判断是否命中缓存。

当服务器返回`304` `Not Modified`的响应时，由于`ETag`重新生成过，`responese header`还会把这个`ETag`返回,，即使这个`ETag`跟之前的没有变化。

#### 3.2 Last-Modified 和 if-modified-since

浏览器第一次请求一个资源的时候，服务器返回的`header`中会加上`Last-Modify`，`Last-Modify`是一个时间标识该资源的最后修改时间，例如`Last-Modify: Thu,31 Dec 2037 23:59:59 GMT`。

当浏览器再次请求该资源时，`request`的请求头中会包含`if-modified-since`，该值为缓存之前返回的`Last-Modify`。

服务器收到`if-modified-since`后，根据资源的最后修改时间判断是否命中缓存。如果命中缓存，则返回`304`，并且不会返回资源内容，并且不会返回`Last-Modify`。

### 4. 补充

判断资源是否修改有两种逻辑：

- 一种是判断最后修改时间是否变了（确实是修改了，但资源的内容可以没有变）
- 另一种是判断资源的内容是否修改。

### 5. 使用缓存的优点

- 减少了冗余的数据传输
- 减少了服务器的负担
- 加快了客户端加载网页的速度
